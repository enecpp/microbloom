@page "/my-applications"
@namespace microbloom.Pages
@attribute [Microsoft.AspNetCore.Authorization.Authorize(Roles = "JobSeeker")]

@using microbloom.DTOs
@using Microsoft.AspNetCore.Components.Authorization
@inject HttpClient Http
@inject NavigationManager NavigationManager

<PageTitle>ğŸ“„ BaÅŸvurularÄ±m - microbloom</PageTitle>

<div class="container my-5">
    <div class="row mb-5">
  <div class="col-md-12">
            <h1 class="display-5 mb-3">
        ğŸ“„ BaÅŸvurularÄ±m
      </h1>
    <p class="lead text-muted">
       YaptÄ±ÄŸÄ±nÄ±z baÅŸvurularÄ± buradan takip edebilirsiniz
 </p>
   </div>
 </div>

    @if (myApplications == null)
  {
    <div class="text-center py-5">
  <div class="spinner-border text-primary mb-3" role="status">
      <span class="visually-hidden">YÃ¼kleniyor...</span>
  </div>
 <p class="text-muted">âŒ› BaÅŸvurularÄ±nÄ±z yÃ¼kleniyor...</p>
   </div>
  }
    else if (!myApplications.Any())
    {
   <div class="card shadow-sm border-0 text-center">
   <div class="card-body py-5">
   <div style="font-size: 4rem; margin-bottom: 1.5rem;">ğŸ“</div>
  <h3 class="card-title">HenÃ¼z BaÅŸvuru Yok</h3>
      <p class="text-muted mb-4">HenÃ¼z hiÃ§ iÅŸ ilanÄ±na baÅŸvurmadÄ±nÄ±z. Ä°lk baÅŸvurunuzu yapÄ±n!</p>
 <a href="/jobs" class="btn btn-primary btn-lg">
 ğŸ” Ä°ÅŸ Ä°lanlarÄ±na GÃ¶z At
     </a>
   </div>
 </div>
    }
    else
{
        <div class="row mb-4 align-items-center">
   <div class="col-md-6">
      <h3 class="mb-0">
     <i class="bi bi-card-list"></i> ğŸ“š BaÅŸvuru GeÃ§miÅŸi
          <span class="badge bg-primary ms-2">@myApplications.Count</span>
    </h3>
        </div>
   <div class="col-md-6 text-md-end">
  <small class="text-muted">
       ğŸ“Š Toplam @myApplications.Count baÅŸvuru yaptÄ±nÄ±z
 </small>
   </div>
 </div>

   <div class="row g-4">
 @foreach (var app in myApplications)
    {
     <div class="col-md-6 col-lg-4">
    <div class="card shadow-sm h-100 hover-lift">
 <div class="card-body">
 <div class="d-flex justify-content-between align-items-start mb-3">
<div class="flex-grow-1">
  <h5 class="card-title mb-1">
    ğŸ’¼ @app.JobTitle
  </h5>
  </div>
  @if (app.Status == "Pending")
   {
   <span class="badge bg-warning">â³ Ä°nceleniyor</span>
 }
        else if (app.Status == "Approved")
    {
  <span class="badge bg-success">âœ… OnaylandÄ±</span>
 }
    else if (app.Status == "Rejected")
   {
    <span class="badge bg-danger">âŒ Reddedildi</span>
  }
   else
  {
      <span class="badge bg-secondary">@app.Status</span>
   }
  </div>

 <p class="card-text small mb-3">
   <i class="bi bi-calendar-event text-primary"></i>
        <strong>ğŸ—“ï¸ BaÅŸvuru Tarihi:</strong><br />
  @app.ApplicationDate.ToString("dd MMMM yyyy, HH:mm")
     </p>

      @if (app.Status == "Pending")
   {
  <div class="alert alert-info small mb-0">
     <i class="bi bi-info-circle"></i>
   BaÅŸvurunuz iÅŸveren tarafÄ±ndan inceleniyor. SonuÃ§ iÃ§in lÃ¼tfen bekleyin.
       </div>
 }
 else if (app.Status == "Approved")
    {
 <div class="alert alert-success small mb-0">
        <i class="bi bi-check-circle"></i>
Tebrikler! BaÅŸvurunuz onaylandÄ±. Ä°ÅŸveren en kÄ±sa sÃ¼rede sizinle iletiÅŸime geÃ§ecektir.
   </div>
   }
     else if (app.Status == "Rejected")
 {
  <div class="alert alert-danger small mb-0">
<i class="bi bi-x-circle"></i>
    Maalesef baÅŸvurunuz reddedildi. DiÄŸer ilanlarÄ± incelemeye devam edebilirsiniz.
  </div>
   }
   </div>

<div class="card-footer bg-light border-top">
    <a href="/job/@app.JobPostingId" class="btn btn-sm btn-outline-primary w-100">
  <i class="bi bi-eye"></i> Ä°lanÄ± GÃ¶rÃ¼ntÃ¼le
   </a>
   </div>
     </div>
      </div>
   }
   </div>

  <!-- Ä°statistikler -->
  <div class="row mt-5">
     <div class="col-md-12">
   <div class="card border-0 shadow-sm">
     <div class="card-body p-4">
        <h5 class="card-title mb-4">ğŸ“ˆ BaÅŸvuru Ä°statistikleri</h5>
  <div class="row text-center">
   <div class="col-md-4">
 <div class="p-3">
      <h3 class="text-primary mb-2">@myApplications.Count</h3>
      <p class="text-muted mb-0">Toplam BaÅŸvuru</p>
    </div>
  </div>
       <div class="col-md-4">
        <div class="p-3">
          <h3 class="text-warning mb-2">@myApplications.Count(a => a.Status == "Pending")</h3>
 <p class="text-muted mb-0">Ä°nceleniyor</p>
      </div>
      </div>
      <div class="col-md-4">
     <div class="p-3">
 <h3 class="text-success mb-2">@myApplications.Count(a => a.Status == "Approved")</h3>
<p class="text-muted mb-0">Onaylanan</p>
    </div>
        </div>
 </div>
 </div>
     </div>
  </div>
     </div>
    }
</div>

<style>
    .hover-lift {
        transition: all 0.3s ease;
    }

    .hover-lift:hover {
     transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(0,0,0,0.15) !important;
    }
</style>

@code {
  private List<ApplicationDto>? myApplications;

  protected override async Task OnInitializedAsync()
  {
    try
    {
      myApplications = await Http.GetFromJsonAsync<List<ApplicationDto>>("api/jobpostings/my-applications");
    }
    catch (Exception ex)
    {
      Console.WriteLine($"BaÅŸvurular Ã§ekilirken hata: {ex.Message}");
      myApplications = new List<ApplicationDto>();
    }
  }
}
