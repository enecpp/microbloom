@page "/universities"
@namespace microbloom.Pages
@using microbloom.DTOs
@inject HttpClient Http
@inject NavigationManager NavigationManager

<PageTitle>&#x1F3EB; Üniversiteler - microbloom</PageTitle>

<style>
  .universities-hero {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  padding: 3rem 2rem;
        border-radius: 20px;
      margin-bottom: 3rem;
        color: white;
        text-align: center;
  box-shadow: 0 10px 40px rgba(102, 126, 234, 0.3);
    }

    .search-box {
        background: white;
        padding: 2rem;
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        margin-bottom: 2rem;
    }

    .filter-buttons {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        margin-top: 1rem;
    }

.filter-btn {
 padding: 0.6rem 1.5rem;
 border: 2px solid #667eea;
    background: white;
        color: #667eea;
      border-radius: 25px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
    }

  .filter-btn:hover, .filter-btn.active {
        background: linear-gradient(135deg, #667eea, #764ba2);
 color: white;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .university-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 2rem;
    }

    .university-card {
        background: white;
    border-radius: 15px;
      overflow: hidden;
        box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        transition: all 0.3s ease;
        cursor: pointer;
      border: 2px solid transparent;
    }

    .university-card:hover {
     transform: translateY(-8px);
        box-shadow: 0 15px 40px rgba(102, 126, 234, 0.25);
        border-color: #667eea;
}

    .card-header {
    background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
  padding: 1.5rem;
        text-align: center;
    }

    .university-icon {
        font-size: 3rem;
   margin-bottom: 0.5rem;
    }

    .card-body {
        padding: 1.5rem;
    }

    .university-type {
        display: inline-block;
        padding: 0.4rem 1rem;
     border-radius: 20px;
        font-size: 0.85rem;
     font-weight: 600;
 margin-bottom: 1rem;
    }

    .state-uni {
        background: #e3f2fd;
        color: #1976d2;
    }

    .private-uni {
    background: #fce4ec;
   color: #c2185b;
 }

    .department-count {
 display: flex;
        align-items: center;
        gap: 0.5rem;
      color: #718096;
        margin-top: 1rem;
    }
</style>

<div class="container my-5">
    <div class="universities-hero">
        <h1>&#x1F3EB; Üniversiteler</h1>
        <p>Türkiye'deki üniversiteleri keþfedin, bölümleri inceleyin</p>
    </div>

    <div class="search-box">
        <div class="mb-3">
     <input type="text" class="form-control form-control-lg" 
    placeholder="&#x1F50D; Üniversite veya þehir ara..."
           @bind="searchTerm" @bind:event="oninput" />
        </div>
        <div class="filter-buttons">
     <button class="filter-btn @(selectedFilter == null ? "active" : "")" 
        @onclick="() => FilterUniversities(null)">
    &#x1F30D; Tümü (@totalCount)
     </button>
     <button class="filter-btn @(selectedFilter == true ? "active" : "")" 
             @onclick="() => FilterUniversities(true)">
            &#x1F3DB; Devlet (@stateCount)
            </button>
    <button class="filter-btn @(selectedFilter == false ? "active" : "")" 
      @onclick="() => FilterUniversities(false)">
                &#x1F3E2; Vakýf (@privateCount)
   </button>
    </div>
    </div>

    @if (isLoading)
    {
   <div class="text-center py-5">
            <div class="spinner-border text-primary" role="status"></div>
          <p class="mt-3 text-muted">Üniversiteler yükleniyor...</p>
        </div>
    }
    else if (filteredUniversities != null && filteredUniversities.Any())
  {
 <div class="university-grid">
            @foreach (var uni in filteredUniversities)
 {
   <div class="university-card" @onclick="() => NavigateToDetail(uni.Id)">
        <div class="card-header">
    <div class="university-icon">&#x1F393;</div>
  <h4 style="margin: 0;">@uni.Name</h4>
      </div>
 <div class="card-body">
       <span class="university-type @(uni.IsStateUniversity ? "state-uni" : "private-uni")">
    @(uni.IsStateUniversity ? "&#x1F3DB; Devlet" : "&#x1F3E2; Vakýf")
          </span>
         <p style="margin: 0.5rem 0;">
        <strong>&#x1F4CD; @uni.City</strong>
     </p>
      <div class="department-count">
           <span>&#x1F4DA;</span>
          <span>@uni.DepartmentCount Bölüm</span>
   </div>
              @if (!string.IsNullOrEmpty(uni.WebSite))
       {
          <a href="@uni.WebSite" target="_blank" class="btn btn-sm btn-outline-primary mt-2" 
    @onclick:stopPropagation="true">
            &#x1F517; Web Sitesi
      </a>
                   }
        </div>
 </div>
   }
        </div>
  }
    else
    {
 <div class="text-center py-5">
            <div style="font-size: 4rem; margin-bottom: 1rem;">&#x1F50D;</div>
          <h3>Sonuç Bulunamadý</h3>
       <p class="text-muted">Arama kriterlerinize uygun üniversite bulunamadý.</p>
        </div>
    }
</div>

@code {
    private List<UniversityDto>? allUniversities;
    private List<UniversityDto>? filteredUniversities;
  private bool isLoading = true;
    private string searchTerm = "";
    private bool? selectedFilter = null;
  private int totalCount = 0;
    private int stateCount = 0;
    private int privateCount = 0;

    protected override async Task OnInitializedAsync()
{
        try
        {
         allUniversities = await Http.GetFromJsonAsync<List<UniversityDto>>("api/university");
      if (allUniversities != null)
 {
         totalCount = allUniversities.Count;
        stateCount = allUniversities.Count(u => u.IsStateUniversity);
    privateCount = allUniversities.Count(u => !u.IsStateUniversity);
          ApplyFilters();
    }
    }
        catch (Exception ex)
   {
            Console.WriteLine($"Hata: {ex.Message}");
      allUniversities = new List<UniversityDto>();
        }
      finally
        {
  isLoading = false;
        }
    }

    private void FilterUniversities(bool? isState)
    {
    selectedFilter = isState;
        ApplyFilters();
    }

    private void ApplyFilters()
    {
        if (allUniversities == null) return;

     filteredUniversities = allUniversities
 .Where(u => selectedFilter == null || u.IsStateUniversity == selectedFilter)
  .Where(u => string.IsNullOrWhiteSpace(searchTerm) || 
         u.Name.Contains(searchTerm, StringComparison.OrdinalIgnoreCase) ||
        u.City.Contains(searchTerm, StringComparison.OrdinalIgnoreCase))
            .ToList();
    }

    private void NavigateToDetail(int id)
    {
        NavigationManager.NavigateTo($"/university/{id}");
    }
}
