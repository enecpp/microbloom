@page "/guide/{CategorySlug}/{ArticleSlug}"
@inject HttpClient Http
@inject NavigationManager Navigation
@using microbloom.DTOs

@if (isLoading)
{
    <div class="container py-5">
      <div class="text-center">
      <div class="spinner-border text-primary" role="status">
   <span class="visually-hidden">Yükleniyor...</span>
    </div>
  <p class="mt-3 text-muted">Makale yükleniyor...</p>
</div>
    </div>
}
else if (errorMessage != null)
{
    <div class="container py-5">
 <div class="alert alert-danger" role="alert">
     <i class="bi bi-exclamation-triangle-fill me-2"></i>
     @errorMessage
   </div>
        <button class="btn btn-primary" @onclick="GoBack">
  <i class="bi bi-arrow-left me-2"></i>Geri Dön
        </button>
    </div>
}
else if (article != null)
{
    <PageTitle>@article.Title - Kariyer Rehberi</PageTitle>
    
    <div class="container py-4">
 <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-4">
     <ol class="breadcrumb">
   <li class="breadcrumb-item">
     <a href="/" class="text-decoration-none">
      <i class="bi bi-house-door me-1"></i>Ana Sayfa
            </a>
 </li>
       <li class="breadcrumb-item">
         <a href="/guide" class="text-decoration-none">Kariyer Rehberi</a>
   </li>
   <li class="breadcrumb-item active" aria-current="page">@article.Title</li>
     </ol>
        </nav>

        <!-- Article Header -->
    <div class="article-header mb-4">
       <button class="btn btn-outline-primary btn-sm mb-3" @onclick="GoBack">
      <i class="bi bi-arrow-left me-2"></i>Rehbere Dön
  </button>
 <h1 class="display-5 fw-bold text-primary mb-3">@article.Title</h1>
       <hr class="border-primary border-2 opacity-50 w-25" />
        </div>

      <!-- Article Content -->
  <div class="row">
       <div class="col-lg-10 mx-auto">
        <div class="card shadow-sm border-0">
      <div class="card-body p-4 p-md-5">
          <div class="article-content">
      @((MarkupString)article.Content)
     </div>
 </div>
   </div>

       <!-- Navigation Buttons -->
       <div class="d-flex justify-content-between mt-4">
  <button class="btn btn-outline-secondary" @onclick="GoBack">
     <i class="bi bi-arrow-left me-2"></i>Geri Dön
    </button>
    <a href="/guide" class="btn btn-primary">
   <i class="bi bi-list-ul me-2"></i>Tüm Rehberler
         </a>
        </div>
        </div>
        </div>
    </div>
}

<style>
    .article-content {
      font-size: 1.1rem;
        line-height: 1.8;
      color: #333;
    }

    .article-content h2 {
  color: var(--bs-primary);
        margin-top: 2rem;
    margin-bottom: 1rem;
   font-weight: 600;
    }

    .article-content h3 {
        color: #555;
        margin-top: 1.5rem;
        margin-bottom: 0.75rem;
  font-weight: 600;
    }

    .article-content p {
        margin-bottom: 1.25rem;
        text-align: justify;
    }

    .article-content ul, 
    .article-content ol {
        margin-bottom: 1.25rem;
   padding-left: 2rem;
    }

    .article-content li {
margin-bottom: 0.5rem;
    }

    .article-content blockquote {
     border-left: 4px solid var(--bs-primary);
   padding-left: 1.5rem;
        margin: 1.5rem 0;
      font-style: italic;
        color: #666;
    }

    .article-content code {
        background-color: #f8f9fa;
  padding: 0.2rem 0.4rem;
    border-radius: 0.25rem;
        font-size: 0.9em;
    }

    .article-content pre {
    background-color: #f8f9fa;
        padding: 1rem;
        border-radius: 0.5rem;
  overflow-x: auto;
    }

    .article-content img {
   max-width: 100%;
        height: auto;
 border-radius: 0.5rem;
        margin: 1.5rem 0;
    }

    .article-header hr {
   margin-top: 0.5rem;
    }

    @@media (max-width: 768px) {
     .article-content {
          font-size: 1rem;
        }
}
</style>

@code {
    [Parameter]
  public string CategorySlug { get; set; } = string.Empty;

    [Parameter]
    public string ArticleSlug { get; set; } = string.Empty;

    private ContentArticleDetailDto? article;
    private bool isLoading = true;
    private string? errorMessage;

    protected override async Task OnInitializedAsync()
    {
    try
        {
         article = await Http.GetFromJsonAsync<ContentArticleDetailDto>(
         $"api/content/{CategorySlug}/{ArticleSlug}");

   if (article == null)
 {
   errorMessage = "Makale bulunamadı.";
   }
  }
        catch (HttpRequestException ex) when (ex.StatusCode == System.Net.HttpStatusCode.NotFound)
        {
   errorMessage = "Aradığınız makale bulunamadı.";
  }
        catch (Exception ex)
        {
     errorMessage = "Makale yüklenirken bir hata oluştu. Lütfen daha sonra tekrar deneyin.";
    Console.WriteLine($"Error loading article: {ex.Message}");
        }
    finally
        {
    isLoading = false;
      }
}

    private void GoBack()
    {
     Navigation.NavigateTo("/guide");
    }
}
