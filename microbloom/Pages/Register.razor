@page "/account/register"
@namespace microbloom.Pages
@using Microsoft.AspNetCore.WebUtilities
@using System
@inject NavigationManager NavigationManager

<PageTitle>🚀 Kayıt Ol - microbloom</PageTitle>

<div class="container mt-5 mb-5">
  <div class="row justify-content-center">
    <div class="col-md-8 col-lg-7">
      <div class="card shadow-lg border-0">
        <div class="card-body p-5">
          <div class="text-center mb-4">
            <div style="font-size: 4rem; margin-bottom: 1rem;">🚀</div>
            <h2 class="mb-2" style="font-weight: 800; color: var(--theme-primary);">Yeni Hesap Oluştur</h2>
            <p class="text-muted mb-0">Bireysel aday veya şirket hesabı açarak microbloom ekosistemine katıl</p>
          </div>

          @if (!string.IsNullOrEmpty(errorMessage))
          {
            <div class="alert alert-danger d-flex align-items-center gap-2" role="alert">
              <i class="bi bi-exclamation-triangle"></i>
              <span>@errorMessage</span>
            </div>
          }

          <form action="/account/register" method="post">
            <div class="mb-4">
              <label class="form-label fw-bold">🧾 Hesap Türü</label>
              <div class="btn-group w-100" role="group" aria-label="Hesap türü seçimi">
                <input type="radio" class="btn-check" name="AccountType" id="account-jobseeker" value="JobSeeker" checked="@(isCompanyAccount ? false : true)" autocomplete="off">
                <label class="btn btn-outline-primary" for="account-jobseeker">👤 Bireysel (İş Arayan)</label>

                <input type="radio" class="btn-check" name="AccountType" id="account-company" value="Employer" checked="@(isCompanyAccount)" autocomplete="off">
                <label class="btn btn-outline-primary" for="account-company">🏢 Şirket (İşveren)</label>
              </div>
            </div>

            <div class="mb-3">
              <label for="email" class="form-label fw-bold">📧 E-posta Adresi</label>
              <input id="email" name="Email" class="form-control" placeholder="ornek@example.com" autocomplete="email" required />
            </div>

            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="firstName" class="form-label fw-bold">👤 Ad</label>
                  <input id="firstName" name="FirstName" class="form-control" placeholder="Adınız" autocomplete="given-name" required />
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="lastName" class="form-label fw-bold">👥 Soyad</label>
                  <input id="lastName" name="LastName" class="form-control" placeholder="Soyadınız" autocomplete="family-name" required />
                </div>
              </div>
            </div>

            <div class="mb-3">
              <label for="password" class="form-label fw-bold">🔒 Şifre</label>
              <input id="password" name="Password" type="password" class="form-control" placeholder="Şifrenizi oluşturun" autocomplete="new-password" required minlength="6" />
              <small class="form-text text-muted">⚠️ En az 6 karakter, bir büyük harf ve bir rakam içermelidir</small>
            </div>

            <div class="mb-4">
              <label for="confirmPassword" class="form-label fw-bold">🔑 Şifre Tekrar</label>
              <input id="confirmPassword" name="ConfirmPassword" type="password" class="form-control" placeholder="Şifrenizi tekrar girin" autocomplete="new-password" required />
            </div>

            <div id="company-fields" class="border rounded p-4 mb-4 bg-light" style="display:@(isCompanyAccount ? "block" : "none")">
              <h5 class="fw-bold mb-3">🏢 Şirket Bilgileri</h5>
              <p class="text-muted small mb-4">Şirket hesabı oluşturuyorsanız aşağıdaki alanları doldurun. Bu bilgiler iş ilanlarınızda adaylara gösterilecektir.</p>

              <div class="mb-3">
                <label for="company-name" class="form-label fw-bold">Şirket Adı</label>
                <input id="company-name" name="CompanyName" class="form-control" placeholder="Örn: microbloom Teknoloji A.Ş." required="@isCompanyAccount" />
              </div>

              <div class="mb-3">
                <label for="company-description" class="form-label fw-bold">Şirket Açıklaması</label>
                <textarea id="company-description" name="CompanyDescription" class="form-control" rows="4" placeholder="Şirketinizin faaliyetleri, kültürü ve ekibiniz hakkında bilgi paylaşın."></textarea>
              </div>

              <div class="mb-3">
                <label for="company-logo" class="form-label fw-bold">Logo Adresi (URL)</label>
                <input id="company-logo" name="CompanyLogoUrl" class="form-control" placeholder="https://..." />
                <small class="text-muted">Opsiyonel. 256x256 piksel boyutlarında bir logo önerilir.</small>
              </div>
            </div>

            <button type="submit" class="btn btn-primary w-100 btn-lg mb-3">
              <span>🚀 Kayıt Ol</span>
            </button>

            <div class="text-center mt-4 pt-3" style="border-top: 1px solid var(--theme-border);">
              <p class="text-muted mb-0">
                Zaten hesabın var mı?
                <a href="/account/login" class="text-decoration-none fw-bold" style="color: var(--theme-primary);">
                  🔑 Giriş Yap
                </a>
              </p>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const jobRadio = document.getElementById("account-jobseeker");
  const companyRadio = document.getElementById("account-company");
  const companyFields = document.getElementById("company-fields");
  const companyNameInput = document.getElementById("company-name");

  const toggleCompanyFields = () => {
    const isCompany = companyRadio && companyRadio.checked;
    if (companyFields) {
      companyFields.style.display = isCompany ? "block" : "none";
    }
    if (companyNameInput) {
      companyNameInput.required = !!isCompany;
    }
  };

  if (jobRadio) {
    jobRadio.addEventListener("change", toggleCompanyFields);
  }
  if (companyRadio) {
    companyRadio.addEventListener("change", toggleCompanyFields);
  }

  toggleCompanyFields();
});
</script>

@code {
  private string errorMessage = string.Empty;
  private bool isCompanyAccount;

  protected override void OnInitialized()
  {
    var uri = NavigationManager.ToAbsoluteUri(NavigationManager.Uri);
    var query = QueryHelpers.ParseQuery(uri.Query);

    if (query.TryGetValue("ErrorMessage", out var error))
    {
      errorMessage = error.ToString();
    }

    if (query.TryGetValue("AccountType", out var accountType))
    {
      isCompanyAccount = string.Equals(accountType.ToString(), "Employer", StringComparison.OrdinalIgnoreCase);
    }
  }
}
