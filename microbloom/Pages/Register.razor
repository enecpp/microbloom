@namespace microbloom.Pages
@page "/account/register"
@using microbloom.Services.Interfaces
@using microbloom.DTOs
@inject IAuthService AuthService
@inject NavigationManager NavigationManager

<PageTitle>&#x1F680; Kayýt Ol - microbloom</PageTitle>

<div class="container mt-5 mb-5">
    <div class="row justify-content-center">
      <div class="col-md-6">
<div class="card shadow-lg border-0">
   <div class="card-body p-5">
         <div class="text-center mb-4">
      <div style="font-size: 4rem; margin-bottom: 1rem;">&#x1F680;</div>
    <h2 class="mb-2" style="font-weight: 800; color: var(--theme-primary);">Yeni Hesap Oluþtur</h2>
  <p class="text-muted">microbloom ailesine katýl ve kariyer yolculuðunu baþlat</p>
      </div>

     @if (!string.IsNullOrEmpty(errorMessage))
   {
       <div class="alert alert-danger d-flex align-items-start" role="alert">
        <i class="bi bi-exclamation-circle me-2" style="font-size: 1.5rem;"></i>
    <div>@errorMessage</div>
      </div>
        }

  @if (!string.IsNullOrEmpty(successMessage))
      {
        <div class="alert alert-success d-flex align-items-start" role="alert">
     <i class="bi bi-check-circle me-2" style="font-size: 1.5rem;"></i>
      <div>@successMessage</div>
   </div>
        }

      <EditForm Model="registerDto" OnValidSubmit="HandleRegister">
       <DataAnnotationsValidator />
   <ValidationSummary class="alert alert-warning" />

      <div class="mb-3">
    <label for="email" class="form-label fw-bold">&#x1F4E7; E-posta Adresi</label>
     <InputText id="email" 
      class="form-control" 
   placeholder="ornek@example.com"
   autocomplete="email" 
   @bind-Value="registerDto.Email" />
      <ValidationMessage For="@(() => registerDto.Email)" class="text-danger small" />
       </div>

     <div class="row">
        <div class="col-md-6">
    <div class="mb-3">
     <label for="firstName" class="form-label fw-bold">&#x1F464; Ad</label>
      <InputText id="firstName" 
     class="form-control" 
       placeholder="Adýnýz"
       autocomplete="given-name" 
    @bind-Value="registerDto.FirstName" />
         <ValidationMessage For="@(() => registerDto.FirstName)" class="text-danger small" />
       </div>
      </div>
    <div class="col-md-6">
       <div class="mb-3">
       <label for="lastName" class="form-label fw-bold">&#x1F465; Soyad</label>
     <InputText id="lastName" 
       class="form-control" 
    placeholder="Soyadýnýz"
      autocomplete="family-name" 
      @bind-Value="registerDto.LastName" />
      </div>
            </div>
    </div>

       <div class="mb-3">
    <label for="password" class="form-label fw-bold">&#x1F512; Þifre</label>
        <InputText id="password" 
  type="password" 
 class="form-control"
     placeholder="Þifrenizi oluþturun" 
   autocomplete="new-password"
        @bind-Value="registerDto.Password" />
      <ValidationMessage For="@(() => registerDto.Password)" class="text-danger small" />
       <small class="form-text text-muted d-block mt-1">
         &#x26A0; En az 6 karakter uzunluðunda olmalýdýr
     </small>
  </div>

     <div class="mb-4">
       <label for="confirmPassword" class="form-label fw-bold">&#x1F511; Þifre Tekrar</label>
        <InputText id="confirmPassword" 
     type="password" 
        class="form-control"
  placeholder="Þifrenizi tekrar girin" 
      autocomplete="new-password"
       @bind-Value="registerDto.ConfirmPassword" />
        <ValidationMessage For="@(() => registerDto.ConfirmPassword)" class="text-danger small" />
   </div>

      <button type="submit" class="btn btn-primary w-100 btn-lg mb-3" disabled="@isSubmitting">
       @if (isSubmitting)
      {
         <span class="spinner-border spinner-border-sm me-2" role="status"></span>
      <span>Kayýt yapýlýyor...</span>
      }
     else
      {
        <span>&#x1F680; Kayýt Ol</span>
     }
</button>

       <div class="text-center mt-4 pt-3" style="border-top: 1px solid var(--theme-border);">
 <p class="text-muted mb-0">
   Zaten hesabýn var mý?
       <a href="/account/login" class="text-decoration-none fw-bold" style="color: var(--theme-primary);">
     &#x1F511; Giriþ Yap
   </a>
       </p>
     </div>
      </EditForm>
  </div>
        </div>
        </div>
    </div>
</div>

@code {
    private RegisterDto registerDto = new();
    private string errorMessage = string.Empty;
    private string successMessage = string.Empty;
    private bool isSubmitting = false;

    private async Task HandleRegister()
{
        try
   {
       isSubmitting = true;
   errorMessage = string.Empty;
        successMessage = string.Empty;

      var result = await AuthService.RegisterAsync(registerDto);

       if (result.Successful)
     {
successMessage = "Kayýt baþarýlý! &#x2705; Giriþ sayfasýna yönlendiriliyorsunuz...";
         await Task.Delay(1500);
     NavigationManager.NavigateTo("/account/login");
        }
        else
   {
       errorMessage = result.Error ?? "Kayýt sýrasýnda bir hata oluþtu.";
    }
       }
  catch (Exception ex)
{
  errorMessage = $"Hata: {ex.Message}";
   }
     finally
        {
   isSubmitting = false;
  }
    }
}
