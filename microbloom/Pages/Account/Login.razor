@page "/account/login"
@namespace microbloom.Pages
@inject NavigationManager NavigationManager

<PageTitle>🔑 Giriş Yap - microbloom</PageTitle>

<div class="container mt-5 mb-5">
    <div class="row justify-content-center">
        <div class="col-md-5">
      <div class="card shadow-lg border-0">
        <div class="card-body p-5">
           <div class="text-center mb-4">
            <div style="font-size: 4rem; margin-bottom: 1rem;">🔑</div>
          <h2 class="mb-2" style="font-weight: 800; color: var(--theme-primary);">Giriş Yap</h2>
           <p class="text-muted">Hesabına giriş yaparak iş fırsatlarını keşfet</p>
                    </div>

      @if (!string.IsNullOrEmpty(errorMessage))
      {
        <div class="alert alert-danger" role="alert">
          @errorMessage
        </div>
      }

       <form action="/account/login" method="post">
        <input type="hidden" name="ReturnUrl" value="@returnUrl" />
                <div class="mb-4">
         <label for="email" class="form-label fw-bold">📧 E-posta Adresi</label>
  <input id="email" name="Email" class="form-control" placeholder="ornek@example.com" autocomplete="username" required />
             </div>

    <div class="mb-4">
          <label for="password" class="form-label fw-bold">🔒 Şifre</label>
       <input id="password" name="Password" type="password" class="form-control" placeholder="Şifrenizi girin" autocomplete="current-password" required />
   </div>

           <button type="submit" class="btn btn-primary w-100 btn-lg mb-3">
   <span>🔑 Giriş Yap</span>
     </button>

        <div class="text-center mt-4 pt-3" style="border-top: 1px solid var(--theme-border);">
      <p class="text-muted mb-0">
            Hesabın yok mu?
            <a href="/account/register" class="text-decoration-none fw-bold" style="color: var(--theme-primary);">
             🚀 Hemen Kayıt Ol
              </a>
     </p>
           </div>
   </form>
         </div>
            </div>
        </div>
    </div>
</div>

@code {
  private string returnUrl = "/";
  private string? errorMessage;

  protected override void OnInitialized()
  {
    var uri = new Uri(NavigationManager.Uri);
    var query = Microsoft.AspNetCore.WebUtilities.QueryHelpers.ParseQuery(uri.Query);

    if (query.TryGetValue("ReturnUrl", out var returnParam) || query.TryGetValue("returnUrl", out returnParam))
    {
      var decoded = Uri.UnescapeDataString(returnParam.ToString());
      if (!string.IsNullOrWhiteSpace(decoded))
      {
        returnUrl = decoded.StartsWith('/') ? decoded : $"/{decoded}";
      }
    }

    if (query.TryGetValue("ErrorMessage", out var errorParam))
    {
      var decodedError = Uri.UnescapeDataString(errorParam.ToString());
      if (!string.IsNullOrWhiteSpace(decodedError))
      {
        errorMessage = decodedError;
      }
    }
  }
}
